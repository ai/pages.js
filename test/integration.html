<!DOCTYPE html>
<html>
  <head>
    <meta charset='UTF-8'>
    <title>Pages.js Integration Test</title>
    <script src="/jquery.js"></script>
    <script src="/pages.js"></script>
    <script>
      jQuery.get = function(url, callback) {
        if ( url == '/integration/deals' ) {
          setTimeout(function() {
            callback(
              '<article class="page deals" ' +
                'data-url="/integration/deals" data-title="Deals">' +
                'Deals' +
              '</article>')
          }, 1000);
        }
      };

      Pages.add('.home', function($, $$, page) {
        page.text(page.text() + '.');
      });

      Pages.add('.deals', function($, $$, page) {
        page.text(page.text() + '!');
      });

      var contacts = '';
      Pages.add('.contacts', {
        load: function($, $$, page) {
          contacts = page.text()
        },
        open: function($, $$, page) {
          page.text(contacts + ' at ' + (new Date).toLocaleTimeString());
        }
      });
    </script>
    <style>
      body.page-loading { opacity: 0.4; }
    </style>
  </head>
  <body>
    <nav>
      <ul>
        <li><a href="/integration">Home</a></li>
        <li><a href="/integration/deals">Deals</a></li>
        <li><a href="/integration/contacts">Contacts</a></li>
      </ul>
    </nav>
    <article class="page home" data-url="/integration" data-title="Pages.js Integration Test">Home</article>
    <article class="page contacts" data-url="/integration/contacts" data-title="Contacts" style="display: none">Contacts</article>
    <script>
      if ( location.protocol == 'file:' ) {
        document.body.innerText =
          'You need to run integration test from Cakefile. See README.md.';
      }
    </script>
  </body>
</html>
